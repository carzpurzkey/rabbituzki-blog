

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon.ico">
  <link rel="icon" type="image/png" href="/images/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="When in doubt, use brute force.">
  <meta name="author" content="Rabbituzki">
  <meta name="keywords" content="">
  <title>LINQ 教程 - Rabbituzki 的笔记们</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/gruvbox-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"blog.rabbituzki.com.cn","root":"/","version":"1.8.6","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"❡"},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":"a9b0666290f750544a1900dff36c0349","google":"UA-127726236-2","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"TMgxzCpM2zFnsClsMHJY2LLc-gzGzoHsz","app_key":"1kPLieLtoBQWf0w6iNxLqkMV","server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Rabbituzki 的笔记们</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/images/background1.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="LINQ 教程">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-09 00:00" pubdate>
        2022年2月9日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      14.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      206
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">LINQ 教程</h1>
            
            <div class="markdown-body">
              <h1>LINQ 教程</h1>
<p><a href="https://www.cainiaojc.com/linq/linq-quantifier-operators.html" target="_blank" rel="noopener">原文</a></p>
<h2 id="一、查询运算符"><a class="header-anchor" href="#一、查询运算符">¶</a>一、查询运算符</h2>
<h3 id="1-投影运算"><a class="header-anchor" href="#1-投影运算">¶</a>1. 投影运算</h3>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>LINQ 查询可以以 <code>GroupBy</code> 或 <code>Select</code> 子句结尾。</p>
</blockquote>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>查询语法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Select</code></td>
<td>操作转换函数的基础项目值</td>
<td><code>select</code></td>
</tr>
<tr>
<td><code>SelectMany</code></td>
<td>操作项目的值是根据上的转换函数，以及拼合成一个单一的序列的序列</td>
<td>使用多个 <code>from</code> 子句</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Select</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> words = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;<br>&#123;<br>   <span class="hljs-string">"an"</span>, <span class="hljs-string">"apple"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-string">"day"</span><br>&#125;;<br><br><span class="hljs-keyword">var</span> query = words.Select(w =&gt; w.Substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>));<br><span class="hljs-comment">// 查询语法：</span><br><span class="hljs-comment">// var query = from w in words select w.Substring(0, 1);</span><br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> s <span class="hljs-keyword">in</span> query)<br>&#123;<br>    Console.WriteLine(s);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">a</span><br><span class="hljs-keyword">a</span><br><span class="hljs-keyword">a</span><br>d<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>SelectMany</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">    <span class="hljs-keyword">var</span> phrases = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"an apple a day"</span>, <span class="hljs-string">"the quick brown fox"</span> &#125;;<br><br>    <span class="hljs-keyword">var</span> query = phrases.SelectMany(p =&gt; p.Split(<span class="hljs-string">' '</span>));<br>    <span class="hljs-comment">// 查询语法</span><br>    <span class="hljs-comment">/*var query = from phrase in phrases</span><br><span class="hljs-comment">                from word in phrase.Split(' ')</span><br><span class="hljs-comment">                select word;*/</span><br><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> s <span class="hljs-keyword">in</span> query)<br>        Console.WriteLine(s);<br><br>Console.ReadLine();<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">an</span><br>apple<br><span class="hljs-keyword">a</span><br>day<br><span class="hljs-keyword">the</span><br>quick<br>brown<br>fox<br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="2-过滤运算"><a class="header-anchor" href="#2-过滤运算">¶</a>2. 过滤运算</h3>
<table>
<thead>
<tr>
<th>筛选运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Where</code></td>
<td>根据谓词函数从集合中返回值。</td>
</tr>
<tr>
<td><code>OfType</code></td>
<td>根据指定类型返回集合中的值。 然而，它取决于它们是否能够向指定类型转换。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Where</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>    &#125;;<br><br><span class="hljs-keyword">var</span> filteredResult = studentList.Where(s =&gt; s.Age &gt; <span class="hljs-number">12</span> &amp;&amp; s.Age &lt; <span class="hljs-number">20</span>);<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var filteredResult = from s in studentList</span><br><span class="hljs-comment">                    where s.Age &gt; 12 &amp;&amp; s.Age &lt; 20</span><br><span class="hljs-comment">                    select s.StudentName;*/</span><br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">John</span><br><span class="hljs-keyword">Bill</span><br><span class="hljs-keyword">Ron</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>OfType</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> mixedList = <span class="hljs-keyword">new</span> ArrayList();<br>mixedList.Add(<span class="hljs-number">0</span>);<br>mixedList.Add(<span class="hljs-string">"One"</span>);<br>mixedList.Add(<span class="hljs-string">"Two"</span>);<br>mixedList.Add(<span class="hljs-number">3</span>);<br>mixedList.Add(<span class="hljs-keyword">new</span> Student &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"Bill"</span> &#125;);<br><br><span class="hljs-keyword">var</span> stringResult = mixedList.OfType&lt;<span class="hljs-keyword">string</span>&gt;();<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var stringResult = from s in mixedList.OfType&lt;string&gt;()</span><br><span class="hljs-comment">    select s;  select s;*/</span><br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">One</span><br><span class="hljs-keyword">Two</span><br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="3-排序运算"><a class="header-anchor" href="#3-排序运算">¶</a>3. 排序运算</h3>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OrderBy</code></td>
<td>根据指定的字段按升序或降序对集合中的元素进行排序。</td>
</tr>
<tr>
<td><code>OrderByDescending</code></td>
<td>根据指定的字段按降序对集合进行排序。仅在方法语法中有效。</td>
</tr>
<tr>
<td><code>ThenBy</code></td>
<td>仅在方法语法中有效。用于按升序进行二次排序。</td>
</tr>
<tr>
<td><code>ThenByDescending</code></td>
<td>仅在方法语法中有效。用于按降序进行二次排序。</td>
</tr>
<tr>
<td><code>Reverse</code></td>
<td>仅在方法语法中有效。按相反顺序对集合排序。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>OrderBy</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>&#125;;<br><br><span class="hljs-comment">// 正序</span><br><span class="hljs-keyword">var</span> studentsInAscOrder = studentList.OrderBy(s =&gt; s.StudentName);<br><span class="hljs-comment">// 逆序</span><br><span class="hljs-keyword">var</span> studentsInAscOrder = studentList.OrderByDecending(s =&gt; s.StudentName);<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var orderByResult = from s in studentList</span><br><span class="hljs-comment">                   orderby s.StudentName </span><br><span class="hljs-comment">                   select s;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">var orderByDescendingResult = from s in studentList</span><br><span class="hljs-comment">                   orderby s.StudentName descending</span><br><span class="hljs-comment">                   select s;*/</span><br></code></pre></div></td></tr></table></figure>
<p>输出：<br>
正序：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">Bill</span><br><span class="hljs-keyword">John</span><br><span class="hljs-keyword">Ram</span><br><span class="hljs-keyword">Ron</span><br><span class="hljs-keyword">Steve</span><br></code></pre></div></td></tr></table></figure>
<p>逆序：</p>
<figure class="highlight"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">Steve<br>Ron<br>Ram<br>John<br>Bill<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p>多重排序</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125;, <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">6</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">18</span> &#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> orderByResult = <span class="hljs-keyword">from</span> s <span class="hljs-keyword">in</span> studentList<br>                   <span class="hljs-keyword">orderby</span> s.StudentName, s.Age <br>                   <span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> &#123; s.StudentName, s.Age &#125;;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Bill,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">25</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">John,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">20</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ron,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">19</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Steve,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">15</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>方法语法中的多重排序的工作方式不同。使用 ThenBy 或 ThenByDecenting 扩展方法进行二次排序。</p>
</blockquote>
</li>
<li>
<p><code>ThenBy</code> 和 <code>ThenByDescending</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125;, <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">6</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">18</span> &#125;<br>&#125;;<br><span class="hljs-keyword">var</span> thenByResult = studentList.OrderBy(s =&gt; s.StudentName).ThenBy(s =&gt; s.Age);<br><br><span class="hljs-keyword">var</span> thenByDescResult = studentList.OrderBy(s =&gt; s.StudentName).ThenByDescending(s =&gt; s.Age);<br></code></pre></div></td></tr></table></figure>
<p>输出：<br>
<code>thenByResult</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Bill,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">25</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">John,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">20</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ron,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">19</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Steve,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">15</span><br></code></pre></div></td></tr></table></figure>
<p><code>thenByDescResult</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Bill,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">25</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">John,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">20</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ron,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">19</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Steve,</span> <span class="hljs-attr">Age:</span> <span class="hljs-number">15</span><br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="4-分组运算"><a class="header-anchor" href="#4-分组运算">¶</a>4. 分组运算</h3>
<table>
<thead>
<tr>
<th>分组运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GroupBy</code></td>
<td><code>GroupBy</code> 操作符根据某个键值返回元素组。每个组由 <code>IGrouping&lt;TKey，TElement&gt;</code> 对象表示。</td>
</tr>
<tr>
<td><code>ToLookup</code></td>
<td><code>ToLookup</code> 与 <code>GroupBy</code> 相同; 唯一的区别是 <code>GroupBy</code> 的执行被延迟，而 <code>ToLookup</code> 的执行是立即的。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>GroupBy</code></p>
<p><code>GroupBy</code> 运算符的结果是组的集合。例如，<code>GroupBy</code> 从 <code>Student</code> 集合返回 <code>IEnumerable &lt;IGrouping &lt;TKey，Student&gt;&gt;</code>：</p>
<p><img src="/images/LINQ/GroupBy-1.png" alt="GroupBy-01"></p>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>LINQ 查询可以以 <code>GroupBy</code> 或 <code>Select</code> 子句结尾。</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Abram"</span> , Age = <span class="hljs-number">21</span> &#125; <br>    &#125;;<br><br><span class="hljs-keyword">var</span> groupedResult = studentList.GroupBy(s =&gt; s.Age);<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var groupedResult = from s in studentList</span><br><span class="hljs-comment">                    group s by s.Age;*/</span><br><br><span class="hljs-comment">//遍历每组        </span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> ageGroup <span class="hljs-keyword">in</span> groupedResult)<br>&#123;<br>    Console.WriteLine(<span class="hljs-string">"Age Group: &#123;0&#125;"</span>, ageGroup .Key); <span class="hljs-comment">//每组都有一个钥匙 </span><br><br>    <span class="hljs-keyword">foreach</span>(Student s <span class="hljs-keyword">in</span> ageGroup) <span class="hljs-comment">// 每组都有内部收藏</span><br>        Console.WriteLine(<span class="hljs-string">"Student Name: &#123;0&#125;"</span>, s.StudentName);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">John</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Bill</span><br><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">21</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Steve</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Abram</span><br><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">20</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram</span><br></code></pre></div></td></tr></table></figure>
<p>如上例所示，您可以使用 <code>foreach</code> 循环对组进行迭代，其中每个组都包含一个键和内部集合。下图显示了调试视图中的结果：</p>
<p><img src="/images/LINQ/GroupBy-2.png" alt="GroupBy-02"></p>
</li>
<li>
<p><code>ToLookup</code></p>
<p><code>ToLookup</code> 与 <code>GroupBy</code> 相同；唯一的区别是 <code>GroupBy</code> 执行被推迟，而 <code>ToLookup</code> 执行是立即执行。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Abram"</span> , Age = <span class="hljs-number">21</span> &#125; <br>    &#125;;<br><br><span class="hljs-keyword">var</span> lookupResult = studentList.ToLookup(s =&gt; s.age);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">in</span> lookupResult)<br>&#123;<br>    Console.WriteLine(<span class="hljs-string">"Age Group: &#123;0&#125;"</span>, <span class="hljs-keyword">group</span>.Key);  <span class="hljs-comment">//每组都有一个键 </span><br><br>    <span class="hljs-keyword">foreach</span>(Student s <span class="hljs-keyword">in</span> <span class="hljs-keyword">group</span>)  <span class="hljs-comment">//每个组都有一个内部集合  </span><br>        Console.WriteLine(<span class="hljs-string">"Student Name: &#123;0&#125;"</span>, s.StudentName);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">18</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">John</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Bill</span><br><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">21</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Steve</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Abram</span><br><span class="hljs-attr">AgeGroup:</span> <span class="hljs-number">20</span><br><span class="hljs-attr">StudentName:</span> <span class="hljs-string">Ram</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>查询语法不支持 <code>ToLookup</code>。</p>
</blockquote>
</li>
</ol>
<h3 id="5-联接运算"><a class="header-anchor" href="#5-联接运算">¶</a>5. 联接运算</h3>
<table>
<thead>
<tr>
<th>联接运算符</th>
<th>用法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Join</code></td>
<td><code>Join</code> 运算符根据一个键连接两个序列(集合)并返回结果序列。</td>
</tr>
<tr>
<td><code>GroupJoin</code></td>
<td><code>GroupJoin</code> 运算符根据键连接两个序列并返回序列组。它类似于 SQL 的左外联接。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Join</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StandardID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Standard</span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StandardID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StandardName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, StandardID =<span class="hljs-number">1</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>, StandardID =<span class="hljs-number">1</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>, StandardID =<span class="hljs-number">2</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , StandardID =<span class="hljs-number">2</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span>  &#125; <br>&#125;;<br><br>IList&lt;Standard&gt; standardList = <span class="hljs-keyword">new</span> List&lt;Standard&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">1</span>, StandardName=<span class="hljs-string">"Standard 1"</span>&#125;,<br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">2</span>, StandardName=<span class="hljs-string">"Standard 2"</span>&#125;,<br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">3</span>, StandardName=<span class="hljs-string">"Standard 3"</span>&#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> innerJoin = studentList.Join(<span class="hljs-comment">// 外序列 </span><br>                      standardList,  <span class="hljs-comment">// 内部序列 </span><br>                      student =&gt; student.StandardID,    <span class="hljs-comment">// externalKeySelector</span><br>                      standard =&gt; standard.StandardID,  <span class="hljs-comment">// innerKeySelector</span><br>                      (student, standard) =&gt; <span class="hljs-keyword">new</span>  <span class="hljs-comment">// 结果选择器</span><br>                                    &#123;<br>                                        StudentName = student.StudentName,<br>                                        StandardName = standard.StandardName<br>                                    &#125;);<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var innerJoin = from s in studentList // 外序列</span><br><span class="hljs-comment">                      join st in standardList //内部序列 </span><br><span class="hljs-comment">                      on s.StandardID equals st.StandardID // 键选择器 </span><br><span class="hljs-comment">                      select new &#123; // 结果选择器 </span><br><span class="hljs-comment">                                    StudentName = s.StudentName, </span><br><span class="hljs-comment">                                    StandardName = st.StandardName </span><br><span class="hljs-comment">                                &#125;;*/</span><br></code></pre></div></td></tr></table></figure>
<p>输出</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">John - Standard <span class="hljs-number">1</span><br>Moin - Standard <span class="hljs-number">1</span><br>Bill - Standard <span class="hljs-number">2</span><br>Ram - Standard <span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure>
<p>下图说明了上面示例中的 <code>Join</code> 运算符的各个部分：</p>
<p><img src="/images/LINQ/Join-1.png" alt="Join-01"></p>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>两个序列（集合）的 <code>StandardID</code> 键必须匹配，否则该项将不包括在结果中。例如，Ron 不与任何标准关联，因此 Ron 不包含在结果集合中。</p>
</blockquote>
</li>
<li>
<p><code>GroupJoin</code></p>
<p><code>GroupJoin</code> 运算符执行与 <code>Join</code> 运算符相同的任务，不同之处在于 <code>GroupJoin</code> 根据指定的组键在组中返回结果。<code>GroupJoin</code> 运算符基于键联接两个序列，并通过匹配键将结果分组，然后返回分组的结果和键的集合。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StandardID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Standard</span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StandardID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StandardName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, StandardID =<span class="hljs-number">1</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>, StandardID =<span class="hljs-number">1</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>, StandardID =<span class="hljs-number">2</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span>,  StandardID =<span class="hljs-number">2</span> &#125;,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> &#125; <br>&#125;;<br><br>IList&lt;Standard&gt; standardList = <span class="hljs-keyword">new</span> List&lt;Standard&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">1</span>, StandardName=<span class="hljs-string">"Standard 1"</span>&#125;,<br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">2</span>, StandardName=<span class="hljs-string">"Standard 2"</span>&#125;,<br>    <span class="hljs-keyword">new</span> Standard()&#123; StandardID = <span class="hljs-number">3</span>, StandardName=<span class="hljs-string">"Standard 3"</span>&#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> groupJoin = standardList.GroupJoin(studentList,  <span class="hljs-comment">//内部序列</span><br>                                std =&gt; std.StandardID, <span class="hljs-comment">//outerKeySelector </span><br>                                s =&gt; s.StandardID,     <span class="hljs-comment">//innerKeySelector</span><br>                                (std, studentsGroup) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-comment">// resultSelector </span><br>                                &#123;<br>                                    Students = studentsGroup,<br>                                    StandarFulldName = std.StandardName<br>                                &#125;);<br><span class="hljs-comment">// 查询语法</span><br><span class="hljs-comment">/*var groupJoin = from std in standardList </span><br><span class="hljs-comment">                    join s in studentList </span><br><span class="hljs-comment">                    on std.StandardID equals s.StandardID</span><br><span class="hljs-comment">                    into studentGroup</span><br><span class="hljs-comment">                    select new &#123; </span><br><span class="hljs-comment">                              Students = studentGroup , </span><br><span class="hljs-comment">                              StandardName = std.StandardName</span><br><span class="hljs-comment">                    &#125;;*/</span><br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> groupJoin)<br>&#123; <br>    Console.WriteLine(item.StandarFulldName );<br><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> stud <span class="hljs-keyword">in</span> item.Students)<br>        Console.WriteLine(stud.StudentName);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ag-0-1fqfscs9qag-1-1fqfscs9q">Standard 1:<br>John,<br>Moin,<br>Standard 2:<br>Bill,<br>Ram,<br>Standard 3:<br></code></pre></div></td></tr></table></figure>
<p>在上面的 <code>GroupJoin</code> 查询示例中，<code>standardList</code> 是外部序列，因为查询是从外部序列开始的。<code>GroupJoin</code> 方法中的第一个参数是指定内部序列，在上面的示例中为 <code>studentList</code>。该方法的第二和第三个参数 <code>GroupJoin()</code> 是指定一个字段，该字段的值应使用 lambda 表达式进行匹配，以便在结果中包含元素。外部序列的键选择器 <code>standard =&gt; standard.StandardID</code> 指示 <code>standardList</code> 中每个元素的 <code>StandardID</code> 字段应与内部序列 <code>studentList</code> 的键匹配 <code>student =&gt; student.StandardID</code>。如果两个键字段的值都匹配，则将该元素包括到分组集合 <code>studentsGroup</code> 中，其中键为 <code>StandardID</code>。<br>
<code>Join</code> 方法中的最后一个参数是用于表达结果的表达式。在上面的示例中，结果选择器包括分组的集合 <code>studentGroup</code> 和 <code>StandardName</code>。<br>
下图说明了将内部序列分组到 <code>studentsGroup</code> 集合中以匹配 <code>StandardID</code> 键，并且可以使用分组的集合来表示结果：</p>
<p><img src="/images/LINQ/GroupJoin-1.png" alt="GroupJoin-01"></p>
<p>结果集将包含具有 <code>Students</code> 和 <code>StandardFullName</code> 属性的匿名对象。学生属性将是其 <code>StandardID</code> 与 <code>Standard.StandardID</code> 匹配的 <code>Student</code> 的集合：</p>
<p><img src="/images/LINQ/GroupJoin-2.png" alt="GroupJoin-02"></p>
</li>
</ol>
<h3 id="6-限定运算"><a class="header-anchor" href="#6-限定运算">¶</a>6. 限定运算</h3>
<p>限定运算符在某些条件下评估序列的元素，然后返回布尔值以指示某些或所有元素都满足条件。</p>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 查询语法不支持限定运算符。</p>
</blockquote>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>All</code></td>
<td>检查序列中的所有元素是否满足指定的条件</td>
</tr>
<tr>
<td><code>Any</code></td>
<td>检查序列中是否有任一元素满足指定条件</td>
</tr>
<tr>
<td><code>Contains</code></td>
<td>检查序列是否包含特定元素</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>All</code></p>
<p><code>All</code> 运算符在指定条件下评估给定集合中的每个元素，如果所有元素均满足条件，则返回 <code>true</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharpa">   IList&lt;Student&gt; studentList &#x3D; new List&lt;Student&gt;() &#123; <br>        new Student() &#123; StudentID &#x3D; 1, StudentName &#x3D; &quot;John&quot;, Age &#x3D; 18 &#125; ,<br>        new Student() &#123; StudentID &#x3D; 2, StudentName &#x3D; &quot;Steve&quot;,  Age &#x3D; 15 &#125; ,<br>        new Student() &#123; StudentID &#x3D; 3, StudentName &#x3D; &quot;Bill&quot;,  Age &#x3D; 25 &#125; ,<br>        new Student() &#123; StudentID &#x3D; 4, StudentName &#x3D; &quot;Ram&quot; , Age &#x3D; 20 &#125; ,<br>        new Student() &#123; StudentID &#x3D; 5, StudentName &#x3D; &quot;Ron&quot; , Age &#x3D; 19 &#125; <br>    &#125;;<br><br>&#x2F;&#x2F; 检查所有学生是否都是青少年    <br>bool areAllStudentsTeenAger &#x3D; studentList.All(s &#x3D;&gt; s.Age &gt; 12 &amp;&amp; s.Age &lt; 20);<br><br>Console.WriteLine(areAllStudentsTeenAger);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Any</code></p>
<p><code>Any</code> 检查元素是否满足给定条件。在以下示例中，<code>Any</code> 操作用于检查是否有任何学生是青少年。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">bool</span> isAnyStudentTeenAger = studentList.Any(s =&gt; s.age &gt; <span class="hljs-number">12</span> &amp;&amp; s.age &lt; <span class="hljs-number">20</span>);<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Contains</code></p>
<p><code>Contains</code> 方法用来确定序列是否包含满足指定条件的元素。如果有返回 <code>true</code>，否则返回 <code>false</code>。以下代码使用默认的 String 比较器来判断序列中是否含有指定的字符串：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">string</span>[] source1 = <span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>[] &#123; <span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>, <span class="hljs-string">"F"</span> &#125;;<br>Console.WriteLine(source1.Contains(<span class="hljs-string">"A"</span>)); <span class="hljs-comment">//输出 "true"</span><br>Console.WriteLine(source1.Contains(<span class="hljs-string">"G"</span>)); <span class="hljs-comment">//输出  "false"</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>上面的示例适用于原始数据类型。但是，它不适用于自定义类。</p>
</blockquote>
<p>看以下示例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>    &#125;;<br><br>Student std = <span class="hljs-keyword">new</span> Student()&#123; StudentID =<span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>&#125;;<br><span class="hljs-keyword">bool</span> result = studentList.Contains(std); <span class="hljs-comment">//returns false</span><br></code></pre></div></td></tr></table></figure>
<p>正如您在上面的示例中看到的，<code>Contains</code> 返回 <code>false</code>，即使s <code>tudentList</code> 中存在“Bill”。这是因为<code>Contains</code> 扩展方法只比较对象的引用，而不比较对象的实际值。所以要比较 <code>student</code> 对象的值，需要通过实现 <code>IEqualityComparer</code> 接口创建一个类，该接口比较两个 <code>student</code> 对象的值并返回 boolean。</p>
<p>以下是 <code>StudentComparer</code> 类，它实现 <code>IEqualityComparer&lt;Student&gt;</code> 接口来比较两个 <code>Students</code> 对象的值：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID &amp;&amp; <br>                   x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">return</span> obj.GetHashCode();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，你可以在 <code>Contains</code> 扩展方法的第二个重载方法中使用上面的 <code>StudentComparer</code> 类，该方法接受第二个参数为 <code>IEqualityComparer</code> 类型，如下所示:</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>    &#125;;<br><br>Student std = <span class="hljs-keyword">new</span> Student()&#123; StudentID =<span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>&#125;;<br><span class="hljs-keyword">bool</span> result = studentList.Contains(std, <span class="hljs-keyword">new</span> StudentComparer()); <span class="hljs-comment">//returns true</span><br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="7-聚合运算"><a class="header-anchor" href="#7-聚合运算">¶</a>7. 聚合运算</h3>
<p>聚合运算符对集合中元素的数值属性执行数学运算，如 <code>Average</code>、<code>Aggregate</code>、<code>Count</code>、<code>Max</code>、<code>Min</code> 和 <code>Sum</code>。</p>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 或 <a href="http://VB.Net" target="_blank" rel="noopener">VB.Net</a> 中的查询语法不支持聚合运算符。</p>
</blockquote>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Aggregate</code></td>
<td>对集合中的值执行自定义聚合操作。</td>
</tr>
<tr>
<td><code>Average</code></td>
<td>计算集合中数字项的平均值。</td>
</tr>
<tr>
<td><code>Count</code></td>
<td>统计集合中的元素。</td>
</tr>
<tr>
<td><code>LongCount</code></td>
<td>统计集合中的元素。</td>
</tr>
<tr>
<td><code>Max</code></td>
<td>查找集合中的最大值。</td>
</tr>
<tr>
<td><code>Min</code></td>
<td>查找集合中的最小值。</td>
</tr>
<tr>
<td><code>Sum</code></td>
<td>计算集合中值的总和。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Aggregate</code></p>
<p>聚合方法执行累加操作。</p>
<p>下面的示例演示了 <code>Aggregate</code> 方法，该方法返回字符串列表中逗号分隔的元素：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;String&gt; strList = <span class="hljs-keyword">new</span> List&lt;String&gt;() &#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span>&#125;;<br><br><span class="hljs-keyword">var</span> commaSeperatedString = strList.Aggregate((s1, s2) =&gt; s1 + <span class="hljs-string">", "</span> + s2);<br><br>Console.WriteLine(commaSeperatedString);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">One</span>, <span class="hljs-keyword">Two</span>, Three, Four, Five<br></code></pre></div></td></tr></table></figure>
<p>下图说明了以上示例中执行的整个聚合操作：</p>
<p><img src="/images/LINQ/Aggregate-1.png" alt="Aggregate-01"></p>
</li>
<li>
<p>带种子值的 <code>Aggregate</code> 方法</p>
<p><code>Aggregate</code> 的第二个重载方法需要第一个参数来累积种子值。第二个参数是 <code>Func</code> 类型的委托：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">TAccumulate Aggregate&lt;TSource, TAccumulate&gt;(TAccumulate seed, Func&lt;TAccumulate, TSource, TAccumulate&gt; func);<br></code></pre></div></td></tr></table></figure>
<p>下面的示例在 <code>Aggregate</code> 扩展方法中将字符串用作种子值：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-comment">// 学生集合</span><br>IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;&gt;() &#123; <br>     <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>     <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>     <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>     <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>     <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>&#125;;<br><br><span class="hljs-keyword">string</span> commaSeparatedStudentNames = studentList.Aggregate&lt;Student, <span class="hljs-keyword">string</span>&gt;(<br>                                     <span class="hljs-string">"Student Names: "</span>,  <span class="hljs-comment">// 种子价值</span><br>                                     (str, s) =&gt; str += s.StudentName + <span class="hljs-string">","</span> ); <br><br>Console.WriteLine(commaSeparatedStudentNames);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm">Student Names: <span class="hljs-keyword">John, </span>Moin, <span class="hljs-keyword">Bill, </span>Ram, Ron,<br></code></pre></div></td></tr></table></figure>
<p>下面的示例使用 <code>Aggregate</code> 运算符添加所有学生的年龄：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-comment">// 学生集合</span><br>IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>         <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>         <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>         <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>         <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>         <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>&#125;;<br><br><span class="hljs-keyword">int</span> SumOfStudentsAge = studentList.Aggregate&lt;Student, <span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">0</span>,                                                   (totalAge, s) =&gt; totalAge += s.Age);<br>Console.WriteLine(studentList);<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p>带有结果选择器的 <code>Aggregate</code> 方法</p>
<p>现在，让我们看看第三个重载方法，它需要 <code>Func</code> 委托表达式的第三个参数作为结果选择器，这样您就可以公式化结果：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TResult Aggregate&lt;TSource, TAccumulate, TResult&gt;(<span class="hljs-keyword">this</span> IEnumerable&lt;TSource&gt; source, TAccumulate seed, Func&lt;TAccumulate, TSource, TAccumulate&gt; func, Func&lt;TAccumulate, TResult&gt; resultSelector);<br></code></pre></div></td></tr></table></figure>
<p>使用结果选择器进行聚合：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">string</span> commaSeparatedStudentNames = studentList.Aggregate&lt;Student, <span class="hljs-keyword">string</span>,<span class="hljs-keyword">string</span>&gt;(String.Empty, <span class="hljs-comment">// 种子值</span><br>                                            (str, s) =&gt; str += s.StudentName + <span class="hljs-string">","</span>, <span class="hljs-comment">// 使用种子值返回结果，String.Empty以str的形式进入lambda表达式</span><br>                                            str =&gt; str.Substring(<span class="hljs-number">0</span>,str.Length - <span class="hljs-number">1</span> )); <span class="hljs-comment">// 删除最后一个逗号的结果选择器</span><br><br>Console.WriteLine(commaSeparatedStudentNames);<br></code></pre></div></td></tr></table></figure>
<p>在上面的示例中，我们指定了一个 lambda 表达式 <code>str =&gt; str.Substring(0,str.Length - 1)</code>，该表达式将删除字符串结果中的最后一个逗号。</p>
<p>输出：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">John, </span>Moin, <span class="hljs-keyword">Bill, </span>Ram, Ron<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Average</code></p>
<p><code>Average</code> 扩展方法计算集合中数值项的平均值。<code>Average</code> 方法返回可空或不可空的十进制值、双值或浮点值：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;&gt;() &#123; <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span> &#125;;<br><br><span class="hljs-keyword">var</span> avg = intList.Average();<br><br>Console.WriteLine(<span class="hljs-string">"Average: &#123;0&#125;"</span>, avg);<br></code></pre></div></td></tr></table></figure>
<p>您可以将类的 <code>int</code>、 <code>decimal</code>、 <code>double</code> 或 <code>float</code> 属性指定为 lambda 表达式，希望获得其平均值。下面的示例演示复杂类型上的 <code>Average</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">var</span> avgAge = studentList.Average(s =&gt; s.Age);<br><br>Console.WriteLine(<span class="hljs-string">"Average Age of Student: &#123;0&#125;"</span>, avgAge);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Average Age of Student:</span> <span class="hljs-number">17.4</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Count</code></p>
<p><code>Count</code> 运算符返回集合中的元素数或满足给定条件的元素数。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span> &#125;;<br><br><span class="hljs-keyword">var</span> totalElements = intList.Count();<br><br>Console.WriteLine(<span class="hljs-string">"元素总数: &#123;0&#125;"</span>, totalElements);<br><br><span class="hljs-keyword">var</span> evenElements = intList.Count(i =&gt; i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>);<br><br>Console.WriteLine(<span class="hljs-string">"偶数元素: &#123;0&#125;"</span>, evenElements);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">元素总数：<span class="hljs-number">5</span><br>偶数元素：<span class="hljs-number">3</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Max</code></p>
<p><code>Max</code> 方法返回集合中最大的数值元素：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br><br><span class="hljs-keyword">var</span> largest = intList.Max();<br><br>Console.WriteLine(<span class="hljs-string">"最大元素: &#123;0&#125;"</span>, largest);<br><br><span class="hljs-keyword">var</span> largestEvenElements = intList.Max(i =&gt; &#123;<br>                                 <span class="hljs-keyword">if</span>(i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>)<br>                                     <span class="hljs-keyword">return</span> i;<br><br>                                 <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>                             &#125;);<br><br>Console.WriteLine(<span class="hljs-string">"最大偶数: &#123;0&#125;"</span>, largestEvenElements );<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">最大元素：<span class="hljs-number">87</span><br>最大偶数：<span class="hljs-number">50</span><br></code></pre></div></td></tr></table></figure>
<p>下面的示例演示复杂类型集合上的 <code>Max</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">15</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">var</span> oldest = studentList.Max(s =&gt; s.Age);<br><br>Console.WriteLine(<span class="hljs-string">"Oldest Student Age: &#123;0&#125;"</span>, oldest);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">最大的学生年龄：<span class="hljs-number">21</span><br></code></pre></div></td></tr></table></figure>
<p>以下示例显示了如何找到集合中名称最长的学生：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">public class Student : IComparable&lt;Student&gt; <br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StandardID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">CompareTo</span>(<span class="hljs-params">Student other</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.StudentName.Length &gt;= other.StudentName.Length)<br>             <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><br>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span> &#123;<br>        <span class="hljs-comment">// 学生集合</span><br>        IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;&gt;() &#123; <br>             <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">13</span>&#125;,<br>             <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Moin"</span>,  Age = <span class="hljs-number">21</span> &#125;,<br>             <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">18</span> &#125;,<br>             <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span>&#125;,<br>             <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Steve"</span> , Age = <span class="hljs-number">15</span> &#125; <br>        &#125;;<br>    <br>        <span class="hljs-keyword">var</span> studentWithLongName = studentList.Max();<br>    <br>        Console.WriteLine(<span class="hljs-string">"Student ID: &#123;0&#125;, Student Name: &#123;1&#125;"</span>, <br>                                     studentWithLongName.StudentID, studentWithLongName.StudentName);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">Student ID：<span class="hljs-number">5</span>，StudentName ：Steve<br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>您可以使用与 <code>Max</code> 相同的方式使用 <code>Min</code> 扩展方法/运算符。</p>
</blockquote>
<p>根据上面的实例，要找到名字最长的学生，需要实现I <code>Comparable&lt;T&gt;</code> 接口，并在 <code>CompareTo</code> 方法中比较学生名字的长度。现在，您可以使用 <code>Max</code> 方法，它将使用 <code>CompareTo</code> 方法来返回适当的结果。</p>
<ol start="7">
<li>
<p><code>Sum</code></p>
<p><code>Sum</code> 方法计算集合中数字项的总和：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br><br><span class="hljs-keyword">var</span> total = intList.Sum();<br><br>Console.WriteLine(<span class="hljs-string">"总计: &#123;0&#125;"</span>, total);<br><br><span class="hljs-keyword">var</span> sumOfEvenElements = intList.Sum(i =&gt; &#123;<br>                             <span class="hljs-keyword">if</span>(i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>)<br>                                 <span class="hljs-keyword">return</span> i;<br><br>                             <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>                         &#125;);<br><br>Console.WriteLine(<span class="hljs-string">"偶数元素的总计: &#123;0&#125;"</span>, sumOfEvenElements );<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">总计：<span class="hljs-number">243</span><br>偶数元素的总计：<span class="hljs-number">90</span><br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="8-元素运算"><a class="header-anchor" href="#8-元素运算">¶</a>8. 元素运算</h3>
<table>
<thead>
<tr>
<th>元素运算符（方法）</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ElementAt</code></td>
<td>返回集合中指定索引处的元素</td>
</tr>
<tr>
<td><code>ElementAtOrDefault</code></td>
<td>返回集合中指定索引处的元素；如果索引超出范围，则返回默认值。</td>
</tr>
<tr>
<td><code>First</code></td>
<td>返回集合的第一个元素，或满足条件的第一个元素。</td>
</tr>
<tr>
<td><code>FirstOrDefault</code></td>
<td>返回集合的第一个元素，或满足条件的第一个元素。如果索引超出范围，则返回默认值。</td>
</tr>
<tr>
<td><code>Last</code></td>
<td>返回集合中的最后一个元素，或满足条件的最后一个元素</td>
</tr>
<tr>
<td><code>LastOrDefault</code></td>
<td>返回集合中的最后一个元素，或满足条件的最后一个元素。如果不存在这样的元素，则返回默认值。</td>
</tr>
<tr>
<td><code>Single</code></td>
<td>返回集合中的唯一元素，或唯一满足条件的元素。如果 <code>Single</code> 在集合中未找到任何元素或一个以上的元素，则抛出 <code>InvalidOperationException</code> 。</td>
</tr>
<tr>
<td><code>SingleOrDefault</code></td>
<td>与 <code>Single</code> 相同，不同之处在于它返回指定泛型类型的默认值，而不是在找不到指定条件的元素时抛出异常。但是，如果在集合中为指定条件找到了多个元素，它将抛出 <code>InvalidOperationException</code>。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>ElementAt</code> 和 <code>ElementAtOrDefault</code></p>
<p><code>ElementAt</code> 方法从给定集合返回指定索引中的元素。如果指定的索引超出集合的范围，则它将抛出“索引超出范围（Index out of range exception）”异常。请注意，索引是从零开始的索引。</p>
<p><code>ElementAtOrDefault</code> 方法还从协作中返回指定索引中的元素，如果指定索引不在集合的范围内，则它将返回数据类型的默认值，而不是引发错误。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第一个元素: &#123;0&#125;"</span>, intList.ElementAt(<span class="hljs-number">0</span>));<br>Console.WriteLine(<span class="hljs-string">"strList中的第一个元素: &#123;0&#125;"</span>, strList.ElementAt(<span class="hljs-number">0</span>));<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第二个元素: &#123;0&#125;"</span>, intList.ElementAt(<span class="hljs-number">1</span>));<br>Console.WriteLine(<span class="hljs-string">"strList中的第二个元素: &#123;0&#125;"</span>, strList.ElementAt(<span class="hljs-number">1</span>));<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第三个元素: &#123;0&#125;"</span>, intList.ElementAtOrDefault(<span class="hljs-number">2</span>));<br>Console.WriteLine(<span class="hljs-string">"strList中的第三个元素: &#123;0&#125;"</span>, strList.ElementAtOrDefault(<span class="hljs-number">2</span>));<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第10个元素: &#123;0&#125; - 默认int值"</span>, <br>             intList.ElementAtOrDefault(<span class="hljs-number">9</span>));        <br>Console.WriteLine(<span class="hljs-string">"strList中的第十个元素: &#123;0&#125; - 默认字符串值(null)"</span>,<br>              strList.ElementAtOrDefault(<span class="hljs-number">9</span>));<br>Console.WriteLine(<span class="hljs-string">"intList. ElementAt (9)抛出异常: 索引超出范围"</span>);<br>Console.WriteLine(<span class="hljs-string">"-------------------------------------------------------------"</span>);<br>Console.WriteLine(intList.ElementAt(<span class="hljs-number">9</span>));<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span>List中的第一个元素：<span class="hljs-number">10</span> <br>strList中的第一个元素：<br><span class="hljs-built_in">int</span>List中的第二元素：<span class="hljs-number">21</span> <br>strList中的第二个元素：   <br><span class="hljs-built_in">int</span>List中的第三个元素：<span class="hljs-number">30</span> <br>strList中的第三个元素：<br><br><span class="hljs-built_in">int</span>List中的第十个元素：<span class="hljs-number">0</span> - 默认<span class="hljs-built_in">int</span>值<br>strList中的第十个元素：- 默认字符串值(<span class="hljs-literal">null</span>)<br><br>----------------------------- --------------------------------<br><br><span class="hljs-built_in">int</span>List.ElementAt(<span class="hljs-number">9</span>) 抛出异常: 索引超出范围<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>First</code> 和 <code>FirstOrDefault</code></p>
<p><code>First</code> 方法使用 lambda 表达式或 <code>Func</code> 委托返回集合的第一个元素，或满足指定条件的第一个元素。如果给定的集合为空或不包含任何满足条件的元素，则它将抛出 InvalidOperation 异常。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-literal">null</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; emptyList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第一个元素: &#123;0&#125;"</span>, intList.First());<br>Console.WriteLine(<span class="hljs-string">"intList中的第一个偶数元素: &#123;0&#125;"</span>, intList.First(i =&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>));<br><br>Console.WriteLine(<span class="hljs-string">"strList中的第一个元素： &#123;0&#125;"</span>, strList.First());<br><br>Console.WriteLine(<span class="hljs-string">"emptyList.First()抛出InvalidOperationException"</span>);<br>Console.WriteLine(<span class="hljs-string">"-------------------------------------------------------------"</span>);<br>Console.WriteLine(emptyList.First());<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span>List中的第一个元素：<span class="hljs-number">7</span> <br><span class="hljs-built_in">int</span>List中的第一个偶数元素：<span class="hljs-number">10</span> <br>strList中的第一个元素：<br>emptyList.First()抛出InvalidOperationException<br>----------------------------------------------- --------------<br>运行时异常：序列不包含任何元素...<br></code></pre></div></td></tr></table></figure>
<p><code>FirstOrDefault</code> 方法与 <code>First</code> 方法具有相同的作用。唯一的区别是，如果集合为空或找不到满足条件的任何元素，它将返回集合数据类型的默认值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-literal">null</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; emptyList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br><br>Console.WriteLine(<span class="hljs-string">"intList中的第一个元素: &#123;0&#125;"</span>, intList.FirstOrDefault());<br>Console.WriteLine(<span class="hljs-string">"intList中的第一个偶数元素: &#123;0&#125;"</span>,intList.FirstOrDefault(i =&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>));<br>Console.WriteLine(<span class="hljs-string">"strList中的第一个元素: &#123;0&#125;"</span>, strList.FirstOrDefault());<br>Console.WriteLine(<span class="hljs-string">"emptyList中的第一个元素: &#123;0&#125;"</span>, emptyList.FirstOrDefault());<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript"><span class="hljs-built_in">int</span>List中的第一个元素：<span class="hljs-number">7</span> <br><span class="hljs-built_in">int</span>List中的第一个偶数元素：<span class="hljs-number">10</span> <br>strList中的第一个元素：<br>emptyList中的第一个元素：<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<ul>
<li>在 <code>First</code> 或 <code>FirstOrDefault</code> 中指定条件时要小心。如果集合不包含任何满足指定条件的元素或包含 <code>null</code> 元素，则 <code>First</code> 将抛出异常。</li>
<li>如果集合包含空元素，则 <code>FirstOrDefault</code> 在计算指定条件时抛出异常。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-literal">null</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br><br>Console.WriteLine(<span class="hljs-string">"intList中大于250的第一个元素: &#123;0&#125;"</span>, intList.First( i &gt; <span class="hljs-number">250</span>));<br><br>Console.WriteLine(<span class="hljs-string">"在 intList 中的第一个偶数元素: &#123;0&#125;"</span>, strList.FirstOrDefault(s =&gt; s.Contains(<span class="hljs-string">"T"</span>)));<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">Run-<span class="hljs-type">time</span> <span class="hljs-keyword">exception</span>: <span class="hljs-keyword">Sequence</span> contains <span class="hljs-keyword">no</span> matching element<br></code></pre></div></td></tr></table></figure>
</blockquote>
</li>
</ol>
<blockquote>
<p>提示</p>
<hr>
<p><code>Last</code> 和 <code>LastOrDefault</code> 与 <code>First</code> 和 <code>FirstOrDefault</code> 类似。</p>
</blockquote>
<ol start="3">
<li>
<p><code>Single</code> 和 <code>SingleOrDefault</code></p>
<p><code>Single</code> 返回集合中的唯一元素，或唯一满足指定条件的元素。如果给定的集合不包含任何元素或包含多个元素，则 <code>Single</code> 抛出 <code>InvalidOperationException</code>。</p>
<p><code>SingleOrDefault</code> 方法与 <code>Single</code> 方法具有相同的作用。唯一的区别是，如果集合为空，不包含一个以上元素或对于指定条件不包含一个或多个元素，则它返回集合数据类型的默认值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; oneElementList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span> &#125;;<br>IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-literal">null</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; emptyList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br><br>Console.WriteLine(<span class="hljs-string">"oneElementList 中的唯一元素: &#123;0&#125;"</span>, oneElementList.Single());<br>Console.WriteLine(<span class="hljs-string">"oneElementList 中的唯一元素: &#123;0&#125;"</span>,oneElementList.SingleOrDefault());<br><br>Console.WriteLine(<span class="hljs-string">"emptyList中的元素: &#123;0&#125;"</span>, emptyList.SingleOrDefault());<br>Console.WriteLine(<span class="hljs-string">"intList中唯一小于10的元素: &#123;0&#125;"</span>,intList.Single(i =&gt; i &lt; <span class="hljs-number">10</span>));<br><br><span class="hljs-comment">//下面抛出一个异常</span><br><span class="hljs-comment">//Console.WriteLine("intList中唯一的元素: &#123;0&#125;", intList.Single());</span><br><span class="hljs-comment">//Console.WriteLine("intList中唯一的元素: &#123;0&#125;", intList.SingleOrDefault());</span><br><span class="hljs-comment">//Console.WriteLine("emptyList中唯一的元素: &#123;0&#125;", emptyList.Single());</span><br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">oneElementList中的唯一元素：<span class="hljs-number">7</span> <br>oneElementList中的唯一元素：<span class="hljs-number">7</span> <br>emptyList中的元素：<span class="hljs-number">0</span> <br><span class="hljs-built_in">int</span>List中唯一小于<span class="hljs-number">10</span>的元素：<span class="hljs-number">7</span><br></code></pre></div></td></tr></table></figure>
<p>以下示例代码将引发异常，因为 <code>Single</code> 或 <code>SingleOrDefault</code> 对于指定条件不返回任何元素或返回多个元素。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">int</span>&gt; oneElementList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span> &#125;;<br>IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;() &#123; <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, <span class="hljs-number">21</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">87</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-literal">null</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; emptyList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br><br><span class="hljs-comment">//下面抛出错误，因为列表包含多个小于100的元素</span><br>Console.WriteLine(<span class="hljs-string">"intList中小于100的元素: &#123;0&#125;"</span>, intList.Single(i =&gt; i &lt; <span class="hljs-number">100</span>));<br><br><span class="hljs-comment">//下面抛出错误，因为列表包含多个小于100的元素</span><br>Console.WriteLine(<span class="hljs-string">"intList中小于100的元素: &#123;0&#125;"</span>, intList.SingleOrDefault(i =&gt; i &lt; <span class="hljs-number">100</span>));<br><br><span class="hljs-comment">//由于列表包含多个元素，下面抛出错误</span><br>Console.WriteLine(<span class="hljs-string">"intList中唯一的元素: &#123;0&#125;"</span>, intList.Single());<br><br><span class="hljs-comment">//由于列表包含多个元素，下面抛出错误</span><br>Console.WriteLine(<span class="hljs-string">"intList中唯一的元素: &#123;0&#125;"</span>, intList.SingleOrDefault());<br><br><span class="hljs-comment">//下面抛出错误，因为列表不包含任何元素</span><br>Console.WriteLine(<span class="hljs-string">"emptyList 中的唯一元素: &#123;0&#125;"</span>, emptyList.Single());<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<ol>
<li><code>Single</code> 要求集合中只有一个元素。</li>
<li><code>Single</code> 当集合中没有任何元素或一个以上元素时，抛出异常。</li>
<li>如果在 <code>Single</code> 中指定了一个条件，并且结果不包含任何元素或包含多个元素，则会引发异常。</li>
<li>如果集合或指定条件中没有元素，<code>SingleOrDefault</code> 将返回泛型集合的数据类型的默认值。</li>
<li>如果集合或指定条件中有多个元素，<code>SingleOrDefault</code> 将引发异常。</li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="9-相等运算"><a class="header-anchor" href="#9-相等运算">¶</a>9. 相等运算</h3>
<p>只有一个相等运算符：<code>SequenceEqual</code>。<code>SequenceEqual</code> 方法检查两个集合中的元素数量，每个元素的值和元素的顺序是否相等。<br>
如果集合包含原始数据类型的元素，则它将比较元素的值和数量，而具有复杂类型元素的集合将检查对象的引用。因此，如果对象具有相同的引用，则将它们视为相等，否则将其视为不相等。<br>
下面的示例演示了带有原始数据类型集合的 <code>SequenceEqual</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123;<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Three"</span>&#125;;<br><br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123;<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Three"</span>&#125;;<br><br><span class="hljs-keyword">bool</span> isEqual = strList1.SequenceEqual(strList2); <span class="hljs-comment">// 返回true</span><br>Console.WriteLine(isEqual);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-literal">true</span><br></code></pre></div></td></tr></table></figure>
<p>如果元素的顺序不同，则 <code>SequenceEqual</code> 方法返回 <code>false</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123;<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Three"</span>&#125;;<br><br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123; <span class="hljs-string">"Two"</span>, <span class="hljs-string">"One"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Three"</span>&#125;;<br><br><span class="hljs-keyword">bool</span> isEqual = strList1.SequenceEqual(strList2); <span class="hljs-comment">// 返回false</span><br>Console.WriteLine(isEqual);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure>
<p><code>SequenceEqual</code> 扩展方法检查两个对象的引用，以确定两个序列是否相等。这可能会给出错误的结果。看以下示例：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Student std = <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"Bill"</span> &#125;;<br><br>IList&lt;Student&gt; studentList1 = <span class="hljs-keyword">new</span> List&lt;Student&gt;()&#123; std &#125;;<br><br>IList&lt;Student&gt; studentList2 = <span class="hljs-keyword">new</span> List&lt;Student&gt;()&#123; std &#125;;<br><br><span class="hljs-keyword">bool</span> isEqual = studentList1.SequenceEqual(studentList2); <span class="hljs-comment">// 返回true</span><br><br>Student std1 = <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"Bill"</span> &#125;;<br>Student std2 = <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"Bill"</span> &#125;;<br><br>IList&lt;Student&gt; studentList3 = <span class="hljs-keyword">new</span> List&lt;Student&gt;()&#123; std1&#125;;<br><br>IList&lt;Student&gt; studentList4 = <span class="hljs-keyword">new</span> List&lt;Student&gt;()&#123; std2 &#125;;<br><br>isEqual = studentList3.SequenceEqual(studentList4);<span class="hljs-comment">// 返回false</span><br></code></pre></div></td></tr></table></figure>
<p>在上面的示例中，<code>studentList1</code> 和 <code>studentList2</code> 包含相同的学生对象  <code>std</code>。因此<code>studentList1.SequenceEqual(studentList2)</code> 返回 <code>true</code>。但是，<code>stdList1</code> 和 <code>stdList2</code> 包含两个单独的学生对象 <code>std1</code> 和 <code>std2</code>。所以现在，即使 <code>std1</code> 和 <code>std2</code> 包含相同的值，<code>stdList1.SequenceEqual(stdList2)</code> 也将返回 <code>false</code>。<br>
要比较两个复杂类型（引用类型或对象）集合的值，需要实现 <code>IEqualityComperar&lt;T&gt;</code> 接口，如下所示：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID &amp;&amp; x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">return</span> obj.GetHashCode();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以使用 <code>SequenceEqual</code> 扩展方法中的上述 <code>StudentComparer</code> 类作为第二个参数来比较值：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList1 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>    &#125;;<br><br>IList&lt;Student&gt; studentList2 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>        <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>    &#125;;<br><span class="hljs-comment">// 以下返回true</span><br><span class="hljs-keyword">bool</span> isEqual = studentList1.SequenceEqual(studentList2, <span class="hljs-keyword">new</span> StudentComparer());<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<ol>
<li><code>SequenceEqual</code> 方法比较项目数及其原始数据类型的值。</li>
<li><code>SequenceEqual</code> 方法比较对象对复杂数据类型的引用。</li>
<li>使用 <code>IEqualityComparer</code> 类可通过 <code>SequenceEqual</code> 方法比较两个复杂类型的集合。</li>
</ol>
</blockquote>
<h3 id="10-串联运算"><a class="header-anchor" href="#10-串联运算">¶</a>10. 串联运算</h3>
<p><code>Concat</code> 方法附加两个相同类型的序列，并返回一个新序列（集合）：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; collection1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; collection2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"Five"</span>, <span class="hljs-string">"Six"</span>&#125;;<br><br><span class="hljs-keyword">var</span> collection3 = collection1.Concat(collection2);<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> collection3)<br>    Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">One</span><br><span class="hljs-keyword">Two</span><br>Three<br>Five<br>Six<br></code></pre></div></td></tr></table></figure>
<h3 id="11-生成运算"><a class="header-anchor" href="#11-生成运算">¶</a>11. 生成运算</h3>
<table>
<thead>
<tr>
<th>生成运算符（方法）</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DefaultIfEmpty</code></td>
<td>如果调用 <code>DefaultIfEmpty</code> 的给定集合为空，则 <code>DefaultIfEmpty</code> 方法将返回一个具有默认值的新集合。</td>
</tr>
<tr>
<td><code>Empty</code></td>
<td>返回一个空集合</td>
</tr>
<tr>
<td><code>Range</code></td>
<td>从第一个元素开始，使用指定数量的具有顺序值的元素生成 <code>IEnumerable&lt;T&gt;</code> 类型的集合。</td>
</tr>
<tr>
<td><code>Repeat</code></td>
<td>生成具有指定元素数的 <code>IEnumerable&lt;T&gt;</code> 类型的集合，并且每个元素包含相同的指定值。</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p><code>Empty</code>、<code>Range</code> 和 <code>Repeat</code> 方法不是 <code>IEnumerable</code> 或 <code>IQueryable</code> 的扩展方法，而只是在静态类 <code>Enumerable</code> 中定义的静态方法。</p>
</blockquote>
<ol>
<li>
<p><code>DefaultIfEmpty</code></p>
<p>如果调用 <code>DefaultIfEmpty</code> 的给定集合为空，则 <code>DefaultIfEmpty</code> 方法将返回一个具有默认值的新集合。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; emptyList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();<br><br><span class="hljs-keyword">var</span> newList1 = emptyList.DefaultIfEmpty(); <br><span class="hljs-keyword">var</span> newList2 = emptyList.DefaultIfEmpty(<span class="hljs-string">"None"</span>); <br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125;"</span> , newList1.Count());<br>Console.WriteLine(<span class="hljs-string">"Value: &#123;0&#125;"</span> , newList1.ElementAt(<span class="hljs-number">0</span>));<br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125;"</span> , newList2.Count());<br>Console.WriteLine(<span class="hljs-string">"Value: &#123;0&#125;"</span> , newList2.ElementAt(<span class="hljs-number">0</span>));<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><span class="hljs-attr">Value:</span><br><span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><span class="hljs-attr">Value:</span> <span class="hljs-string">None</span><br></code></pre></div></td></tr></table></figure>
<p>下面的示例演示复杂类型集合的 <code>DefaultIfEmpty</code> 方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; emptyStudentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;();<br><br><span class="hljs-keyword">var</span> newStudentList1 = studentList.DefaultIfEmpty(<span class="hljs-keyword">new</span> Student());<br><br><span class="hljs-keyword">var</span> newStudentList2 = studentList.DefaultIfEmpty(<span class="hljs-keyword">new</span> Student()&#123; <br>               StudentID = <span class="hljs-number">0</span>, <br>               StudentName = <span class="hljs-string">""</span> &#125;);<br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125; "</span>, newStudentList1.Count());<br>Console.WriteLine(<span class="hljs-string">"Student ID: &#123;0&#125; "</span>, newStudentList1.ElementAt(<span class="hljs-number">0</span>));<br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125; "</span>, newStudentList2.Count());<br>Console.WriteLine(<span class="hljs-string">"Student ID: &#123;0&#125; "</span>, newStudentList2.ElementAt(<span class="hljs-number">0</span>).StudentID);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><span class="hljs-attr">Student ID:</span><br><span class="hljs-attr">Count:</span> <span class="hljs-number">1</span><br><span class="hljs-attr">Student ID:</span> <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Empty</code></p>
<p><code>Empty</code> 方法返回指定类型的空集合：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> emptyCollection1 = Enumerable.Empty&lt;<span class="hljs-keyword">string</span>&gt;();<br><span class="hljs-keyword">var</span> emptyCollection2 = Enumerable.Empty&lt;Student&gt;();<br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125; "</span>, emptyCollection1.Count());<br>Console.WriteLine(<span class="hljs-string">"Type: &#123;0&#125; "</span>, emptyCollection1.GetType().Name );<br><br>Console.WriteLine(<span class="hljs-string">"Count: &#123;0&#125; "</span>,emptyCollection2.Count());<br>Console.WriteLine(<span class="hljs-string">"Type: &#123;0&#125; "</span>, emptyCollection2.GetType().Name );<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Type:</span> <span class="hljs-string">String[]</span><br><span class="hljs-attr">Count:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">Type:</span> <span class="hljs-string">Student[]</span><br><span class="hljs-attr">Count:</span> <span class="hljs-number">0</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Range</code></p>
<p><code>Range</code> 方法返回 <code>IEnumerable&lt;T&gt;</code> 类型的集合，该集合具有指定数量的元素和从第一个元素开始的顺序值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> intCollection = Enumerable.Range(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);<br>Console.WriteLine(<span class="hljs-string">"总计数: &#123;0&#125; "</span>, intCollection.Count());<br><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; intCollection.Count(); i++)<br>   Console.WriteLine(<span class="hljs-string">"值，索引位置为 &#123;0&#125; : &#123;1&#125;"</span>, i, intCollection.ElementAt(i));<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">总计数: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">0</span> : <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">1</span> : <span class="hljs-number">11</span><br>值，索引位置为 <span class="hljs-number">2</span> : <span class="hljs-number">12</span><br>值，索引位置为 <span class="hljs-number">3</span> : <span class="hljs-number">13</span><br>值，索引位置为 <span class="hljs-number">4</span> : <span class="hljs-number">14</span><br>值，索引位置为 <span class="hljs-number">5</span> : <span class="hljs-number">15</span><br>值，索引位置为 <span class="hljs-number">6</span> : <span class="hljs-number">16</span><br>值，索引位置为 <span class="hljs-number">7</span> : <span class="hljs-number">17</span><br>值，索引位置为 <span class="hljs-number">8</span> : <span class="hljs-number">18</span><br>值，索引位置为 <span class="hljs-number">9</span> : <span class="hljs-number">19</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Repeat</code></p>
<p><code>Repeat</code> 方法使用指定数量的元素生成 <code>IEnumerable&lt;T&gt;</code> 类型的集合，每个元素包含相同的指定值。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> intCollection = Enumerable.Repeat&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);<br>Console.WriteLine(<span class="hljs-string">"总数: &#123;0&#125; "</span>, intCollection.Count());<br><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; intCollection.Count(); i++)<br>   Console.WriteLine(<span class="hljs-string">"值，索引位置为 &#123;0&#125; : &#123;1&#125;"</span>, i, intCollection.ElementAt(i));<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">总数：<span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">0</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">1</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">2</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">3</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">4</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">5</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">6</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">7</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">8</span>: <span class="hljs-number">10</span><br>值，索引位置为 <span class="hljs-number">9</span>: <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure>
</li>
</ol>
<h3 id="12-集合运算"><a class="header-anchor" href="#12-集合运算">¶</a>12. 集合运算</h3>
<table>
<thead>
<tr>
<th>集合运算符</th>
<th>用法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Distinct</code></td>
<td>返回集合中的非重复值。</td>
</tr>
<tr>
<td><code>Except</code></td>
<td>返回两个序列之间的差，这意味着一个集合中的元素不出现在第二个集合中。</td>
</tr>
<tr>
<td><code>Intersect</code></td>
<td>返回两个序列的交集，即同时出现在两个集合中的元素。</td>
</tr>
<tr>
<td><code>Union</code></td>
<td>返回两个序列中的唯一元素，这意味着出现在两个序列中的唯一元素。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Distinct</code></p>
<p><code>Distinct</code> 扩展方法从给定集合返回一个新的唯一元素集合。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span> &#125;;<br><br>IList&lt;<span class="hljs-keyword">int</span>&gt; intList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">int</span>&gt;()&#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> &#125;;<br><br><span class="hljs-keyword">var</span> distinctList1 = strList.Distinct();<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> str <span class="hljs-keyword">in</span> distinctList1)<br>   Console.WriteLine(str);<br><br><span class="hljs-keyword">var</span> distinctList2 = intList.Distinct();<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> distinctList2)<br>   Console.WriteLine(i);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">One<br>Two<br>Three<br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br><span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure>
<p><code>Distinct</code> 扩展方法不比较复杂类型对象的值。为了比较复杂类型的值，需要实现 <code>IEqualityComparer&lt;T&gt;</code> 接口。在下面的示例中，<code>StudentComparer</code> 类实现 <code>IEqualityComparer&lt;Student&gt;</code> 来比较 <code>Student</code> 对象：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <br>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID <br>               &amp;&amp; x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">return</span> obj.StudentID.GetHashCode();<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以在 <code>Distinct</code> 方法中传递上述 <code>StudentComparer</code> 类的对象作为参数来比较 <code>Student</code> 对象，如下所示：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">var</span> distinctStudents = studentList.Distinct(<span class="hljs-keyword">new</span> StudentComparer()); <br><br><span class="hljs-keyword">foreach</span>(Student std <span class="hljs-keyword">in</span> distinctStudents)<br>   Console.WriteLine(std.StudentName);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">John</span><br><span class="hljs-keyword">Steve</span><br><span class="hljs-keyword">Bill</span><br><span class="hljs-keyword">Ron</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 查询语法不支持 <code>Distinct</code> 运算符。但是，您可以使用 <code>Distinct</code> 方法查询变量或将整个查询包装到括号中，然后调用 <code>Distinct</code>。</p>
</blockquote>
</li>
<li>
<p><code>Except</code></p>
<p><code>Except</code> 方法需要两个集合。它返回一个新集合，其中包含来自第一个集合的元素，该元素在第二个集合（参数集合）中不存在。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123;<span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123;<span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span>, <span class="hljs-string">"Six"</span>, <span class="hljs-string">"Seven"</span>, <span class="hljs-string">"Eight"</span>&#125;;<br><br><span class="hljs-keyword">var</span> result = strList1.Except(strList2);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> result)<br>      Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">One</span><br><span class="hljs-keyword">Two</span><br>Three<br></code></pre></div></td></tr></table></figure>
<p><code>Except</code> 扩展方法不返回复杂类型集合的正确结果。您需要实现 <code>IEqualityComparer&lt;T&gt;</code> 接口，以便从 <code>Except</code> 方法获得正确的结果。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID &amp;&amp; x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>    &#123;<br>        <span class="hljs-keyword">return</span> obj.StudentID.GetHashCode();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以在 <code>Except</code> 扩展方法中通过 <code>StudentComparer</code> 类，以获取正确的结果：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList1 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>&#125;;<br><br>IList&lt;Student&gt; studentList2 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>    <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>&#125;;<br><br><span class="hljs-keyword">var</span> resultedCol = studentList1.Except(studentList2,<span class="hljs-keyword">new</span> StudentComparer()); <br><br><span class="hljs-keyword">foreach</span>(Student std <span class="hljs-keyword">in</span> resultedCol)<br>    Console.WriteLine(std.StudentName);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">John</span><br><span class="hljs-attribute">Steve</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 和 <a href="http://VB.Net" target="_blank" rel="noopener">VB.Net</a> 查询语法不支持 <code>Except</code> 运算符。但是，您可以对查询变量使用 <code>Except</code> 方法，或者将整个查询包装到括号中，然后调用 <code>Except</code>。</p>
</blockquote>
</li>
<li>
<p><code>Intersect</code></p>
<p><code>Intersect</code> 扩展方法需要两个集合。它返回一个新集合，其中包含两个集合中都存在的公共元素：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span>, <span class="hljs-string">"Six"</span>, <span class="hljs-string">"Seven"</span>, <span class="hljs-string">"Eight"</span>&#125;;<br><br><span class="hljs-keyword">var</span> result = strList1.Intersect(strList2);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> result)<br>      Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">Four</span><br><span class="hljs-attribute">Five</span><br></code></pre></div></td></tr></table></figure>
<p><code>Intersect</code> 扩展方法不返回复杂类型集合的正确结果。为了从 <code>Intersect</code> 方法中得到正确的结果，需要实现 <code>IEqualityComparer&lt;T&gt;</code> 接口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <br>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID &amp;&amp; <br>                        x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">return</span> obj.StudentID.GetHashCode();<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以在 <code>Intersect</code> 扩展方法中通过 <code>StudentComparer</code> 类，以获取正确的结果：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList1 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>   &#125;;<br><br>IList&lt;Student&gt; studentList2 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">var</span> resultedCol = studentList1.Intersect(studentList2, <span class="hljs-keyword">new</span> StudentComparer()); <br><br><span class="hljs-keyword">foreach</span>(Student std <span class="hljs-keyword">in</span> resultedCol)<br>   Console.WriteLine(std.StudentName);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs">Bill<br>Ron<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>Union</code></p>
<p><code>Union</code> 扩展方法需要两个集合，并返回一个新集合，其中包含两个集合中不同的元素。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList1 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"three"</span>, <span class="hljs-string">"Four"</span> &#125;;<br>IList&lt;<span class="hljs-keyword">string</span>&gt; strList2 = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <span class="hljs-string">"Two"</span>, <span class="hljs-string">"THREE"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br><br><span class="hljs-keyword">var</span> result = strList1.Union(strList2);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> result)<br>      Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">One<br>Two<br><span class="hljs-literal">three</span><br><span class="hljs-literal">THREE</span><br>Four<br>Five<br></code></pre></div></td></tr></table></figure>
<p><code>Union</code> 扩展方法不能为复杂类型的集合返回正确的结果。您需要实现 <code>IEqualityComparer&lt;T&gt;</code> 接口，以便从 <code>Union</code> 方法中获取正确的结果。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <br>&#123;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>class StudentComparer : IEqualityComparer&lt;Student&gt;<br>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Student x, Student y</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">if</span> (x.StudentID == y.StudentID &amp;&amp; x.StudentName.ToLower() == y.StudentName.ToLower())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br><br>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetHashCode</span>(<span class="hljs-params">Student obj</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      <span class="hljs-keyword">return</span> obj.StudentID.GetHashCode();<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以在 <code>Union</code> 扩展方法中传递上述 <code>StudentComparer</code> 类以获得正确的结果：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList1 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">15</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>   &#125;;<br><br>IList&lt;Student&gt; studentList2 = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>      <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">19</span> &#125; <br>   &#125;;<br><br><span class="hljs-keyword">var</span> resultedCol = studentList1.Union(studentList2, <span class="hljs-keyword">new</span> StudentComparer()); <br><br><span class="hljs-keyword">foreach</span>(Student std <span class="hljs-keyword">in</span> resultedCol)<br>   Console.WriteLine(std.StudentName);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-keyword">John</span><br><span class="hljs-keyword">Steve</span><br><span class="hljs-keyword">Bill</span><br><span class="hljs-keyword">Ron</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 和 <a href="http://VB.Net" target="_blank" rel="noopener">VB.Net</a> 查询语法不支持联合运算符。但是，您可以对查询变量使用 <code>Union</code> 方法，或者将整个查询包装到方括号中，然后调用 <code>Union</code>。</p>
</blockquote>
</li>
</ol>
<h3 id="13-分区运算"><a class="header-anchor" href="#13-分区运算">¶</a>13. 分区运算</h3>
<p>分区运算符将序列（集合）分为两部分，并返回其中一部分。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Skip</code></td>
<td>从序列中的第一个元素开始，将元素跳到指定的位置。</td>
</tr>
<tr>
<td><code>SkipWhile</code></td>
<td>根据条件跳过元素，直到元素不满足条件为止。如果第一个元素本身不满足条件，那么它将跳过0个元素并返回序列中的所有元素。</td>
</tr>
<tr>
<td><code>Take</code></td>
<td>从序列中的第一个元素开始，将元素带到指定的位置。</td>
</tr>
<tr>
<td><code>TakeWhile</code></td>
<td>从第一个元素返回元素，直到元素不满足条件为止。如果第一个元素本身不满足条件，则返回一个空集合。</td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>Skip</code></p>
<p><code>Skip</code> 方法从第一个元素开始跳过指定数量的元素，并返回其余元素。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;()&#123; <span class="hljs-string">"One"</span>, <span class="hljs-string">"Two"</span>, <span class="hljs-string">"Three"</span>, <span class="hljs-string">"Four"</span>, <span class="hljs-string">"Five"</span> &#125;;<br><br><span class="hljs-keyword">var</span> newList = strList.Skip(<span class="hljs-number">2</span>);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> str <span class="hljs-keyword">in</span> newList)<br>   Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">Three</span><br><span class="hljs-attribute">Four</span><br><span class="hljs-attribute">Five</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>SkipWhile</code></p>
<p>顾名思义，LINQ 中的 <code>SkipWhile</code> 扩展方法将跳过集合中的元素，直到指定的条件为 <code>true</code>。一旦任何元素的指定条件变为 <code>false</code>，它将返回一个包含所有剩余元素的新集合。<br>
<code>SkipWhile</code> 方法有两种重载方法：</p>
<ul>
<li>
<p>接受 <code>Func&lt;TSource, bool&gt;</code> 类型的谓词：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> System.Collections.Generic.IEnumerable&lt;TSource&gt; SkipWhile&lt;TSource&gt; (<span class="hljs-keyword">this</span> System.Collections.Generic.IEnumerable&lt;TSource&gt; source, Func&lt;TSource,<span class="hljs-keyword">bool</span>&gt; predicate);<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p>接受 <code>Func&lt;TSource, int, bool&gt;</code> 通过元素索引的谓词类型：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> System.Collections.Generic.IEnumerable&lt;TSource&gt; SkipWhile&lt;TSource&gt; (<span class="hljs-keyword">this</span> System.Collections.Generic.IEnumerable&lt;TSource&gt; source, Func&lt;TSource,<span class="hljs-keyword">int</span>,<span class="hljs-keyword">bool</span>&gt; predicate);<br></code></pre></div></td></tr></table></figure>
</li>
</ul>
<p>在下面的示例中，<code>SkipWhile</code> 方法跳过所有元素，直到找到长度等于或大于 4 个字符的字符串：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <br>                                          <span class="hljs-string">"One"</span>, <br>                                          <span class="hljs-string">"Two"</span>, <br>                                          <span class="hljs-string">"Three"</span>, <br>                                          <span class="hljs-string">"Four"</span>, <br>                                          <span class="hljs-string">"Five"</span>, <br>                                          <span class="hljs-string">"Six"</span>  &#125;;<br><br><span class="hljs-keyword">var</span> resultList = strList.SkipWhile(s =&gt; s.Length &lt; <span class="hljs-number">4</span>);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> resultList)<br>      Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">Three</span><br><span class="hljs-attribute">Four</span><br><span class="hljs-attribute">Five</span><br><span class="hljs-attribute">Six</span><br></code></pre></div></td></tr></table></figure>
<p>在上面的示例中，由于前两个元素的长度小于 3，所以 <code>SkipWhile</code> 跳过前两个元素，并找到长度等于或大于 4 的第三个元素。一旦找到长度等于或大于 4 个字符的任何元素，它将不跳过其他任何元素元素，即使小于 4 个字符。<br>
现在，看以下示例，该示例中，其中 <code>SkipWhile</code> 不会跳过任何元素，因为第一个元素的指定条件为 <code>false</code>：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <br>                                          <span class="hljs-string">"Three"</span>, <br>                                          <span class="hljs-string">"One"</span>, <br>                                          <span class="hljs-string">"Two"</span>, <br>                                          <span class="hljs-string">"Four"</span>, <br>                                          <span class="hljs-string">"Five"</span>, <br>                                          <span class="hljs-string">"Six"</span>  &#125;;<br><br><span class="hljs-keyword">var</span> resultList = strList.SkipWhile(s =&gt; s.Length &lt; <span class="hljs-number">4</span>);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> resultList)<br>      Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight stata"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata">Three<br><span class="hljs-keyword">One</span><br><span class="hljs-keyword">Two</span><br>Four<br>Five<br>Six<br></code></pre></div></td></tr></table></figure>
<p><code>SkipWhile</code> 的第二个重载传递每个元素的索引：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <br>                                          <span class="hljs-string">"One"</span>, <br>                                          <span class="hljs-string">"Two"</span>, <br>                                          <span class="hljs-string">"Three"</span>, <br>                                          <span class="hljs-string">"Four"</span>, <br>                                          <span class="hljs-string">"Five"</span>, <br>                                          <span class="hljs-string">"Six"</span>  &#125;;<br><br><span class="hljs-keyword">var</span> result = strList.SkipWhile((s, i) =&gt; s.Length &gt; i);<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">string</span> str <span class="hljs-keyword">in</span> result)<br>   Console.WriteLine(str);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">Five</span><br><span class="hljs-attribute">Six</span><br></code></pre></div></td></tr></table></figure>
<p>在上面的示例中，lambda 表达式包括元素和元素的索引作为参数。它会跳过所有元素，直到字符串元素的长度大于其索引。</p>
<blockquote>
<p><strong>注意</strong></p>
<hr>
<p>C# 查询语法不支持 <code>Skip</code> 和 <code>SkipWhile</code> 运算符。但是，您可以对查询变量使用 <code>Skip</code>/<code>SkipWhile</code> 方法，或者将整个查询包装到括号中，然后调用 <code>Skip</code>/<code>SkipWhile</code>。</p>
</blockquote>
</li>
</ol>
<blockquote>
<p><strong>提示</strong></p>
<hr>
<p><code>Take</code> 和 <code>TakeWhile</code> 与 <code>Skip</code> 和 <code>SkipWhile</code> 用法相同，但作用相反。</p>
</blockquote>
<h2 id="二、转换运算符"><a class="header-anchor" href="#二、转换运算符">¶</a>二、转换运算符</h2>
<p>LINQ 中的 转换运算符可用于转换序列（集合）中元素的类型。转换运算符分为三种：As 运算符（<code>AsEnumerable</code> 和 <code>AsQueryable</code>），To 运算符（<code>ToArray</code>、<code>ToDictionary</code>、<code>ToList</code> 和 <code>ToLookup</code>）和转换运算符（<code>Cast</code> 和 <code>OfType</code>）。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AsEnumerable</code></td>
<td>将输入序列作为 <code>IEnumerable&lt;T&gt;</code> 返回</td>
</tr>
<tr>
<td><code>AsQueryable</code></td>
<td>将 <code>IEnumerable</code> 转换为 <code>IQueryable</code>，以模拟远程查询提供程序</td>
</tr>
<tr>
<td><code>Cast</code></td>
<td>将非泛型集合转换为泛型集合（<code>IEnumerable</code> 到 <code>IEnumerable</code>）</td>
</tr>
<tr>
<td><code>OfType</code></td>
<td>基于指定类型筛选集合</td>
</tr>
<tr>
<td><code>ToArray</code></td>
<td>将集合转换为数组</td>
</tr>
<tr>
<td><code>ToDictionary</code></td>
<td>根据键选择器函数将元素放入字典中</td>
</tr>
<tr>
<td><code>ToList</code></td>
<td>将集合转换为 List</td>
</tr>
<tr>
<td><code>ToLookup</code></td>
<td>将元素分组到 <code>Lookup&lt;TKey,TElement&gt;</code></td>
</tr>
</tbody>
</table>
<ol>
<li>
<p><code>AsEnumerable</code> 和 <code>AsQueryable</code></p>
<p><code>AsEnumerable</code> 和 <code>AsQueryable</code> 方法分别将源对象转换或转换为 <code>IEnumerable&lt;T&gt;</code> 或 <code>IQueryable&lt;T&gt;</code>。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><br>&#123;<br><br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> ReportTypeProperties&lt;T&gt;(T obj)<br>   &#123;<br>      Console.WriteLine(<span class="hljs-string">"Compile-time type: &#123;0&#125;"</span>, <span class="hljs-keyword">typeof</span>(T).Name);<br>      Console.WriteLine(<span class="hljs-string">"Actual type: &#123;0&#125;"</span>, obj.GetType().Name);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      Student[] studentArray = &#123; <br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">31</span> &#125; ,<br>            &#125;;   <br><br>      ReportTypeProperties( studentArray);<br>      ReportTypeProperties(studentArray.AsEnumerable());<br>      ReportTypeProperties(studentArray.AsQueryable());   <br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight elm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elm"><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">IEnumerable</span>`1<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">IQueryable</span>`1<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">EnumerableQuery</span>`1<br></code></pre></div></td></tr></table></figure>
<p>如上例所示，<code>AsEnumerable</code> 和 <code>AsQueryable</code> 方法分别将编译时类型转换为 <code>IEnumerable</code> 和 <code>IQueryable</code>。</p>
</li>
<li>
<p><code>Cast</code></p>
<p><code>Cast</code> 的作用与 <code>AsEnumerable&lt;T&gt;</code> 相同。它将源对象强制转换为 <code>IEnumerable&lt;T&gt;</code>。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span><br>&#123;<br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> ReportTypeProperties&lt;T&gt;(T obj)<br>   &#123;<br>      Console.WriteLine(<span class="hljs-string">"Compile-time type: &#123;0&#125;"</span>, <span class="hljs-keyword">typeof</span>(T).Name);<br>      Console.WriteLine(<span class="hljs-string">"Actual type: &#123;0&#125;"</span>, obj.GetType().Name);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-keyword">string</span>[] args</span>)</span><br><span class="hljs-function"></span>   &#123;<br>      Student[] studentArray = &#123; <br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, Age = <span class="hljs-number">18</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  Age = <span class="hljs-number">21</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  Age = <span class="hljs-number">25</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , Age = <span class="hljs-number">20</span> &#125; ,<br>               <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , Age = <span class="hljs-number">31</span> &#125; ,<br>            &#125;;   <br><br>      ReportTypeProperties( studentArray);<br>      ReportTypeProperties(studentArray.Cast&lt;Student&gt;());<br>   &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight elm"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elm"><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">IEnumerable</span>`1<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">IEnumerable</span>`1<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br><span class="hljs-type">Compile</span>-time <span class="hljs-keyword">type</span>: <span class="hljs-type">IEnumerable</span>`1<br><span class="hljs-type">Actual</span> <span class="hljs-keyword">type</span>: <span class="hljs-type">Student</span>[]<br></code></pre></div></td></tr></table></figure>
<p><code>studentArray.Cast&lt;Student&gt;</code> 与 <code>(IEnumerable&lt;Student&gt;) studentArray</code> 相同，但是 <code>Cast&lt;Student&gt;</code> 可读性更好。</p>
</li>
<li>
<p><code>ToArray</code>、<code>ToList</code> 和 <code>ToDictionary</code></p>
<p>顾名思义，<code>ToArray</code>、<code>ToList</code> 和 <code>ToDictionary</code> 方法的源对象转换分别为一个数组，列表或字典。<br>
To 运算符强制执行查询。它强制远程查询提供者执行查询并从底层数据源（如SQL Server数据库）获取结果。</p>
<ul>
<li>
<p><code>ToArray</code> 和 <code>ToList</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;<span class="hljs-keyword">string</span>&gt; strList = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;() &#123; <br>                                          <span class="hljs-string">"One"</span>, <br>                                          <span class="hljs-string">"Two"</span>, <br>                                          <span class="hljs-string">"Three"</span>, <br>                                          <span class="hljs-string">"Four"</span>, <br>                                          <span class="hljs-string">"Three"</span> <br>                                          &#125;;<br><br><span class="hljs-keyword">string</span>[] strArray = strList.ToArray&lt;<span class="hljs-keyword">string</span>&gt;();<span class="hljs-comment">// 将列表转换为数组</span><br><br>IList&lt;<span class="hljs-keyword">string</span>&gt; list = strArray.ToList&lt;<span class="hljs-keyword">string</span>&gt;(); <span class="hljs-comment">// converts array into list</span><br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p><code>ToDictionary</code><br>
将泛型列表转换为泛型词典：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">IList&lt;Student&gt; studentList = <span class="hljs-keyword">new</span> List&lt;Student&gt;() &#123; <br>                  <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"John"</span>, age = <span class="hljs-number">18</span> &#125; ,<br>                  <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">2</span>, StudentName = <span class="hljs-string">"Steve"</span>,  age = <span class="hljs-number">21</span> &#125; ,<br>                  <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">3</span>, StudentName = <span class="hljs-string">"Bill"</span>,  age = <span class="hljs-number">18</span> &#125; ,<br>                  <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">4</span>, StudentName = <span class="hljs-string">"Ram"</span> , age = <span class="hljs-number">20</span> &#125; ,<br>                  <span class="hljs-keyword">new</span> Student() &#123; StudentID = <span class="hljs-number">5</span>, StudentName = <span class="hljs-string">"Ron"</span> , age = <span class="hljs-number">21</span> &#125; <br>               &#125;;<br><br><span class="hljs-comment">//以下将列表转换成字典，其中StudentId是键</span><br>IDictionary&lt;<span class="hljs-keyword">int</span>, Student&gt; studentDict = <br>                              studentList.ToDictionary&lt;Student, <span class="hljs-keyword">int</span>&gt;(s =&gt; s.StudentID); <br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> studentDict.Keys)<br>    Console.WriteLine(<span class="hljs-string">"Key: &#123;0&#125;, Value: &#123;1&#125;"</span>, <br>                              key, (studentDict[key] <span class="hljs-keyword">as</span> Student).StudentName);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight yaml"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yaml"><span class="hljs-attr">Key:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">Value:</span> <span class="hljs-string">John</span><br><span class="hljs-attr">Key:</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">Value:</span> <span class="hljs-string">Steve</span><br><span class="hljs-attr">Key:</span> <span class="hljs-number">3</span><span class="hljs-string">,</span> <span class="hljs-attr">Value:</span> <span class="hljs-string">Bill</span><br><span class="hljs-attr">Key:</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-attr">Value:</span> <span class="hljs-string">Ram</span><br><span class="hljs-attr">Key:</span> <span class="hljs-number">5</span><span class="hljs-string">,</span> <span class="hljs-attr">Value:</span> <span class="hljs-string">Ron</span><br></code></pre></div></td></tr></table></figure>
<p>下图显示了上面示例中的 <code>studentDict</code> 如何包含一个 key-value 对，其中 key 是 <code>StudentID</code>，value 是 <code>Student</code> 对象。</p>
<p><img src="/images/LINQ/ToDictionary-1.png" alt="ToDictionary-01"></p>
</li>
</ul>
</li>
</ol>
<h2 id="三、表达式（Expression）"><a class="header-anchor" href="#三、表达式（Expression）">¶</a>三、表达式（Expression）</h2>
<h3 id="1-表达式基础"><a class="header-anchor" href="#1-表达式基础">¶</a>1. 表达式基础</h3>
<p>可以将 lambda 表达式分配给 <code>Func</code> 或 <code>Action</code> 类型委托，以处理内存中的集合。.NET 编译器在编译时将分配给 <code>Func</code> 或 <code>Action</code> 类型委托的 lambda 表达式转换为可执行代码。<br>
LINQ 引入了一种名为表达式的新类型，该类型代表强类型的 lambda 表达式。这意味着 lambda 表达式也可以分配给 <code>Expression&lt;TDelegate&gt;</code> 类型。.NET编译器将分配给 <code>Expression&lt;TDelegate&gt;</code> 的 lambda 表达式转换为 <strong>表达式树</strong>，而不是可执行代码。远程 LINQ 查询提供程序使用此表达式树作为数据结构，以其构建运行时查询（例如 LINQ-to-SQL，EntityFramework或实现 <code>IQueryable&lt;T&gt;</code> 接口的任何其他 LINQ 查询提供程序）。</p>
<p>下图说明了将 lambda 表达式分配给 <code>Func</code> 或 <code>Action</code> 委托与 LINQ 中的 <code>Expression</code> 时的区别：</p>
<p><img src="/images/LINQ/Expression-1.png" alt="Expression-01"></p>
<h4 id="定义表达式"><a class="header-anchor" href="#定义表达式">¶</a>定义表达式</h4>
<p>引用 <code>System.Linq.Expressions</code> 命名空间，并使用 <code>Expression&lt;TDelegate&gt;</code> 类定义一个表达式。<code>Expression&lt;TDelegate&gt;</code> 需要委托类型 <code>Func</code> 或 <code>Action</code>。</p>
<p>例如，你可以将 lambda 表达式赋给 <code>Func</code> 类型委托的 <code>isTeenAger</code> 变量，如下所示:</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <br>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> StudentID &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> StudentName &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Age &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;<br>&#125;<br><br>Func&lt;Student, <span class="hljs-keyword">bool</span>&gt; isTeenAger = s =&gt; s.Age &gt; <span class="hljs-number">12</span> &amp;&amp; s.Age &lt; <span class="hljs-number">20</span>;<br></code></pre></div></td></tr></table></figure>
<p>现在，您可以使用表达式包装 <code>Func</code> 委托，将上述 <code>Func</code> 类型委托转换为表达式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt; isTeenAgerExpr = s =&gt; s.Age &gt; <span class="hljs-number">12</span> &amp;&amp; s.Age &lt; <span class="hljs-number">20</span>;<br></code></pre></div></td></tr></table></figure>
<p>以相同的方式，如果您不从委托返回值，则还可以用表达式包装 <code>Action&lt;T&gt;</code> 类型委托。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression&lt;Action&lt;Student&gt;&gt; printStudentName = s =&gt; Console.WriteLine(s.StudentName);<br></code></pre></div></td></tr></table></figure>
<p>至此，您已经定义了 <code>Expression&lt;TDelegate&gt;</code> 类型。现在，让我们看看如何调用由 <code>Expression&lt;TDelegate&gt;</code> 包装的委托。</p>
<h4 id="调用表达式"><a class="header-anchor" href="#调用表达式">¶</a>调用表达式</h4>
<p>您可以用与委托相同的方式调用由表达式包裹的委托，但是首先需要使用 <code>Compile</code> 方法进行编译。<code>Compile</code> 返回 <code>Func</code> 或  <code>Action</code> 类型的委托，以便您可以像委托一样调用它。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt; isTeenAgerExpr = s =&gt; s.Age &gt; <span class="hljs-number">12</span> &amp;&amp; s.Age &lt; <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">//使用Compile方法编译Expression以将其作为委托调用</span><br>Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;  isTeenAger = isTeenAgerExpr.Compile();<br><br><span class="hljs-comment">//Invoke</span><br><span class="hljs-keyword">bool</span> result = isTeenAger(<span class="hljs-keyword">new</span> Student()&#123; StudentID = <span class="hljs-number">1</span>, StudentName = <span class="hljs-string">"Steve"</span>, Age = <span class="hljs-number">20</span>&#125;);<br></code></pre></div></td></tr></table></figure>
<h3 id="2-表达式树"><a class="header-anchor" href="#2-表达式树">¶</a>2. 表达式树</h3>
<p>顾名思义，表达式树不过是按树状数据结构排列的表达式。表达式树中的每个节点都是一个表达式。例如，表达式树可用于表示数学公式 <code>x &lt; y</code>，其中 <code>x</code>、<code>&lt;</code> 和 <code>y</code> 将表示为表达式，并排列在树状结构中。<br>
表达式树是 lambda 表达式的内存表示形式。它保存查询的实际元素，而不是查询的结果。<br>
表达式树使 lambda 表达式的结构透明和显式。您可以与表达式树中的数据进行交互，就像与其他任何数据结构一样。<br>
例如，看以下 <code>isTeenAgerExpr</code> 表达式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt; isTeenAgerExpr = s =&gt; s.age &gt; <span class="hljs-number">12</span> &amp;&amp; s.age &lt; <span class="hljs-number">20</span>;<br></code></pre></div></td></tr></table></figure>
<p>编译器会将上面的表达式转换为以下表达式树：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression.Lambda&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt;(<br>                Expression.AndAlso(<br>                    Expression.GreaterThan(Expression.Property(pe, <span class="hljs-string">"Age"</span>), Expression.Constant(<span class="hljs-number">12</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>))),<br>                    Expression.LessThan(Expression.Property(pe, <span class="hljs-string">"Age"</span>), Expression.Constant(<span class="hljs-number">20</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>)))),<br>                        <span class="hljs-keyword">new</span>[] &#123; pe &#125;);<br></code></pre></div></td></tr></table></figure>
<p>您也可以手动构建表达式树。让我们看看如何为以下简单的 lambda 表达式构建表达式树：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Func&lt;Student, <span class="hljs-keyword">bool</span>&gt; isAdult = s =&gt; s.age &gt;= <span class="hljs-number">18</span>;<br></code></pre></div></td></tr></table></figure>
<p>此 <code>Func</code> 类型委托将被视为以下方法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">function</span>(<span class="hljs-params">Student s</span>)</span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> s.Age &gt; <span class="hljs-number">18</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h4 id="创建表达式树"><a class="header-anchor" href="#创建表达式树">¶</a>创建表达式树</h4>
<p>要创建表达式树，首先，创建一个参数表达式，其中 <code>Student</code> 是参数的类型，“s” 是参数的名称，如下所示：</p>
<ul>
<li>
<p>步骤一：在 C# 中创建参数表达式</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">ParameterExpression pe = Expression.Parameter(<span class="hljs-keyword">typeof</span>(Student), <span class="hljs-string">"s"</span>);<br></code></pre></div></td></tr></table></figure>
<p>现在，使用 <code>Expression.Property()</code> 创建 <code>s.Age</code> 表达式，其中 <code>s</code> 是参数，<code>Age</code> 是 <code>Student</code> 的属性名称。（<code>Expression</code> 是一个抽象类，其中包含用于手动创建表达式树的静态帮助器方法。）</p>
</li>
<li>
<p>步骤二：在 C# 中创建属性表达式</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">MemberExpression me = Expression.Property(pe, <span class="hljs-string">"Age"</span>);<br></code></pre></div></td></tr></table></figure>
<p>现在，为 <code>18</code> 创建一个常量表达式：</p>
</li>
<li>
<p>步骤三：在 C# 中创建常量表达式</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">ConstantExpression constant = Expression.Constant(<span class="hljs-number">18</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>));<br></code></pre></div></td></tr></table></figure>
<p>到目前为止，我们已经为 <code>s.Age</code>（成员表达式）和 <code>18</code>（常量表达式）构建了表达式树。现在，我们需要检查成员表达式是否大于常量表达式。为此，请使用 <code>Expression.GreaterThanOrEqual</code> 方法，并将成员表达式和常量表达式作为参数传递：</p>
</li>
<li>
<p>步骤四：在 C# 中创建二进制表达式</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">BinaryExpression body = Expression.GreaterThanOrEqual(me, constant);<br></code></pre></div></td></tr></table></figure>
<p>至此，我们为 lambda 表达式主体 <code>s.Age&gt;= 18</code> 构建了一个表达式树。我们现在需要将参数表达式和主体表达式连接起来。使用 <code>Expression.Lambda(body,parameters array)</code> 连接 lambda 表达式 <code>s =&gt; s.age &gt;= 18</code> 的 body（主体）和 parameter（参数）部分：</p>
</li>
<li>
<p>步骤五：在 C# 中创建 Lambda 表达式</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> isAdultExprTree = Expression.Lambda&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt;(body, <span class="hljs-keyword">new</span>[] &#123; pe &#125;);<br></code></pre></div></td></tr></table></figure>
</li>
</ul>
<p>这样，您可以为带有 lambda 表达式的简单 <code>Func</code> 委托构建表达式树。</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">ParameterExpression pe = Expression.Parameter(<span class="hljs-keyword">typeof</span>(Student), <span class="hljs-string">"s"</span>);<br><br>MemberExpression me = Expression.Property(pe, <span class="hljs-string">"Age"</span>);<br><br>ConstantExpression constant = Expression.Constant(<span class="hljs-number">18</span>, <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">int</span>));<br><br>BinaryExpression body = Expression.GreaterThanOrEqual(me, constant);<br><br><span class="hljs-keyword">var</span> ExpressionTree = Expression.Lambda&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt;(body, <span class="hljs-keyword">new</span>[] &#123; pe &#125;);<br><br>Console.WriteLine(<span class="hljs-string">"表达式树: &#123;0&#125;"</span>, ExpressionTree);<br><br>Console.WriteLine(<span class="hljs-string">"表达式树体: &#123;0&#125;"</span>, ExpressionTree.Body);<br><br>Console.WriteLine(<span class="hljs-string">"表达式树中的参数个数: &#123;0&#125;"</span>, <br>                                ExpressionTree.Parameters.Count);<br><br>Console.WriteLine(<span class="hljs-string">"表达式树中的参数: &#123;0&#125;"</span>, ExpressionTree.Parameters[<span class="hljs-number">0</span>]);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">表达式树: s =&gt; (s.Age &gt;= 18)</span><br><span class="hljs-section">表达式树体: (s.Age &gt;= 18)</span><br><span class="hljs-section">表达式树中的参数个数: 1</span><br><span class="hljs-section">表达式树中的参数: s</span><br></code></pre></div></td></tr></table></figure>
<p>下图说明了创建表达式树的整个过程：</p>
<p><img src="/images/LINQ/Expression-2.png" alt="Express-02"></p>
<h4 id="为什么使用表达树？"><a class="header-anchor" href="#为什么使用表达树？">¶</a>为什么使用表达树？</h4>
<p>在上一节中，我们已经看到分配给 lambda 表达式 <code>Func&lt;T&gt;</code> 编译为可执行代码，分配给 lambda 表达式 <code>Expression&lt;TDelegate&gt;</code> 类型编译为表达式树。<br>
可执行代码在同一个应用程序域中执行，以处理内存中的集合。可枚举的静态类包含用于实现 <code>IEnumerable&lt;T&gt;</code> 接口的内存中集合的扩展方法，例如 <code>List&lt;T&gt;</code>、<code>Dictionary &lt;T&gt;</code> 等。<code>Enumerable</code> 类中的扩展方法接受 <code>Func</code> 类型委托的谓词参数。例如，<code>Where</code> 扩展方法接受 <code>Func&lt;TSource，bool&gt;</code> 谓词。然后，将其编译为 IL（中间语言）以处理同一 AppDomain 中的内存中集合。<br>
下图显示了 <code>Enumerable</code> 类中的 <code>Where</code> 扩展方法包括 <code>Func</code> 委托作为参数的情况：</p>
<p><img src="/images/LINQ/Expression-3.png" alt="Expression-03"></p>
<p><code>Func</code> 委托是原始的可执行代码，因此，如果调试代码，则会发现 <code>Func</code> 委托将表示为不透明代码。您无法看到其参数，返回类型和主体：</p>
<p><img src="/images/LINQ/Expression-4.png" alt="Expression-04"></p>
<p><code>Func </code>委托用于内存中的集合，因为它将在同一个 AppDomain 中进行处理，但是诸如 LINQ-to-SQL，EntityFramework 或其他提供 LINQ 功能的第三方产品的远程 LINQ 查询提供者呢？他们将如何解析已编译为原始可执行代码的 lambda 表达式，以了解参数，lambda 表达式的返回类型以及构建运行时查询以进一步处理？答案是表达树。<br>
<code>Expression&lt;TDelegate&gt;</code> 被编译成称为表达式树的数据结构。<br>
如果调试代码，则表达式代表将如下所示：</p>
<p><img src="/images/LINQ/Expression-5.png" alt="Expression-05"></p>
<p>现在您可以看到普通委托和表达式之间的区别。表达式树是透明的。您可以从表达式中检索参数，返回类型和主体表达式信息：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">Expression&lt;Func&lt;Student, <span class="hljs-keyword">bool</span>&gt;&gt; isTeenAgerExpr = s =&gt; s.Age &gt; <span class="hljs-number">12</span> &amp;&amp; s.Age &lt; <span class="hljs-number">20</span>;<br><br>Console.WriteLine(<span class="hljs-string">"Expression: &#123;0&#125;"</span>, isTeenAgerExpr );<br><br>Console.WriteLine(<span class="hljs-string">"表达式类型: &#123;0&#125;"</span>, isTeenAgerExpr.NodeType);<br><br><span class="hljs-keyword">var</span> parameters = isTeenAgerExpr.Parameters;<br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> param <span class="hljs-keyword">in</span> parameters)<br>&#123;<br>    Console.WriteLine(<span class="hljs-string">"参数名称: &#123;0&#125;"</span>, param.Name);<br>    Console.WriteLine(<span class="hljs-string">"参数类型: &#123;0&#125;"</span>, param.Type.Name );<br>&#125;<br><span class="hljs-keyword">var</span> bodyExpr = isTeenAgerExpr.Body <span class="hljs-keyword">as</span> BinaryExpression;<br><br>Console.WriteLine(<span class="hljs-string">"表达式主体左侧: &#123;0&#125;"</span>, bodyExpr.Left);<br>Console.WriteLine(<span class="hljs-string">"二进制表达式类型: &#123;0&#125;"</span>, bodyExpr.NodeType);<br>Console.WriteLine(<span class="hljs-string">"表达式主体右侧: &#123;0&#125;"</span>, bodyExpr.Right);<br>Console.WriteLine(<span class="hljs-string">"返回类型: &#123;0&#125;"</span>, isTeenAgerExpr.ReturnType);<br></code></pre></div></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">Expression: s =&gt; ((s.Age &gt; 12) AndAlso (s.Age &lt; 20))</span><br><span class="hljs-section">表达式类型: Lambda</span><br><span class="hljs-section">参数名称: s</span><br><span class="hljs-section">参数类型: Student</span><br><span class="hljs-section">表达式主体左侧: (s.Age &gt; 12)</span><br><span class="hljs-section">二进制表达式类型: AndAlso</span><br><span class="hljs-section">表达式主体右侧: (s.Age &lt; 20)</span><br><span class="hljs-section">返回类型: System.Boolean</span><br></code></pre></div></td></tr></table></figure>
<p>不在同一应用程序域中执行针对 LINQ-to-SQL 或 Entity Framework 的 LINQ 查询。例如，对于 Entity Framework 的以下 LINQ 查询永远不会在程序内部实际执行：</p>
<figure class="highlight csharp"><table><tr><td class="gutter hljs hljs hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp"><span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> s <span class="hljs-keyword">in</span> dbContext.Students<br>            <span class="hljs-keyword">where</span> s.Age &gt;= <span class="hljs-number">18</span><br>            <span class="hljs-keyword">select</span> s;<br></code></pre></div></td></tr></table></figure>
<p>首先将其转换为 SQL 语句，然后在数据库服务器上执行。<br>
在查询表达式中找到的代码必须转换为 SQL 查询，该查询可以作为字符串发送到另一个进程。对于 LINQ-to-SQL 或 Entity Framework，该过程恰好是 SQL Server 数据库。将数据结构（如表达式树）转换为 SQL 显然比将原始IL或可执行代码转换为 SQL 容易得多，因为正如您看到的，从表达式中检索信息很容易。<br>
创建表达式树的目的是将诸如查询表达式之类的代码转换为可以传递给其他进程并在此处执行的字符串。<br>
可查询的静态类包括接受表达式类型的谓词参数的扩展方法。将该谓词表达式转换为表达式树，然后将其作为数据结构传递到远程 LINQ 提供程序，以便提供程序可以从表达式树构建适当的查询并执行查询。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
                    
                      <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0/%E6%95%99%E7%A8%8B/">教程</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a>
                    
                      <a class="hover-with-bg" href="/tags/NET/">.NET</a>
                    
                      <a class="hover-with-bg" href="/tags/C/">C#</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/02/09/ASP.NET-Core-%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ASP.NET Core 认证与授权</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/10/Linux-IO/">
                        <span class="hidden-mobile">Linux I/O 模式及 select、poll 和 epoll 详解</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "TMgxzCpM2zFnsClsMHJY2LLc-gzGzoHsz",
          app_key: "1kPLieLtoBQWf0w6iNxLqkMV",
          placeholder: "说点什么....",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: true,
          recordIP: true,
          serverURLs: "",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> &nbsp;and&nbsp; <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a9b0666290f750544a1900dff36c0349";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-127726236-2', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
